!function(){function l(){}function m(a){this.buttonBar=d.getElementById("wmd-button-bar"+a),this.preview=d.getElementById("wmd-preview"+a),this.input=d.getElementById("wmd-input"+a)}function n(b,c){var i,j,k,d=this,e=[],f=0,g="none",l=function(a,b){g!=a&&(g=a,b||n()),h.isIE&&"moving"==g?k=null:j=setTimeout(m,1)},m=function(a){k=new o(c,a),j=void 0};this.setCommandMode=function(){g="command",n(),j=setTimeout(m,0)},this.canUndo=function(){return f>1},this.canRedo=function(){return!!e[f+1]},this.undo=function(){d.canUndo()&&(i?(i.restore(),i=null):(e[f]=new o(c),e[--f].restore(),b&&b())),g="none",c.input.focus(),m()},this.redo=function(){d.canRedo()&&(e[++f].restore(),b&&b()),g="none",c.input.focus(),m()};var n=function(){var a=k||new o(c);return!!a&&("moving"==g?void(i||(i=a)):(i&&(e[f-1].text!=i.text&&(e[f++]=i),i=null),e[f++]=a,e[f+1]=null,void(b&&b())))},p=function(a){var b=!1;if((a.ctrlKey||a.metaKey)&&!a.altKey){var c=a.charCode||a.keyCode,e=String.fromCharCode(c);switch(e.toLowerCase()){case"y":d.redo(),b=!0;break;case"z":a.shiftKey?d.redo():d.undo(),b=!0}}if(b)return a.preventDefault&&a.preventDefault(),void(window.event&&(window.event.returnValue=!1))},q=function(a){if(!a.ctrlKey&&!a.metaKey){var b=a.keyCode;b>=33&&b<=40||b>=63232&&b<=63235?l("moving"):8==b||46==b||127==b?l("deleting"):13==b?l("newlines"):27==b?l("escape"):(b<16||b>20)&&91!=b&&l("typing")}},r=function(){a.addEvent(c.input,"keypress",function(a){!a.ctrlKey&&!a.metaKey||a.altKey||89!=a.keyCode&&90!=a.keyCode||a.preventDefault()});var b=function(){(h.isIE||k&&k.text!=c.input.value)&&void 0==j&&(g="paste",n(),m())};a.addEvent(c.input,"keydown",p),a.addEvent(c.input,"keydown",q),a.addEvent(c.input,"mousedown",function(){l("moving")}),c.input.onpaste=b,c.input.ondrop=b},s=function(){r(),m(!0),n()};s()}function o(b,c){var e=this,f=b.input;this.init=function(){a.isVisible(f)&&(!c&&d.activeElement&&d.activeElement!==f||(this.setInputAreaSelectionStartEnd(),this.scrollTop=f.scrollTop,(!this.text&&f.selectionStart||0===f.selectionStart)&&(this.text=f.value)))},this.setInputAreaSelection=function(){if(a.isVisible(f))if(void 0===f.selectionStart||h.isOpera){if(d.selection){if(d.activeElement&&d.activeElement!==f)return;f.focus();var b=f.createTextRange();b.moveStart("character",-f.value.length),b.moveEnd("character",-f.value.length),b.moveEnd("character",e.end),b.moveStart("character",e.start),b.select()}}else f.focus(),f.selectionStart=e.start,f.selectionEnd=e.end,f.scrollTop=e.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(b.ieCachedRange||!f.selectionStart&&0!==f.selectionStart){if(d.selection){e.text=a.fixEolChars(f.value);var c=b.ieCachedRange||d.selection.createRange(),g=a.fixEolChars(c.text),h="",i=h+g+h;c.text=i;var j=a.fixEolChars(f.value);c.moveStart("character",-i.length),c.text=g,e.start=j.indexOf(h),e.end=j.lastIndexOf(h)-h.length;var k=e.text.length-a.fixEolChars(f.value).length;if(k){for(c.moveStart("character",-g.length);k--;)g+="\n",e.end+=1;c.text=g}b.ieCachedRange&&(e.scrollTop=b.ieCachedScrollTop),b.ieCachedRange=null,this.setInputAreaSelection()}}else e.start=f.selectionStart,e.end=f.selectionEnd},this.restore=function(){void 0!=e.text&&e.text!=f.value&&(f.value=e.text),this.setInputAreaSelection(),f.scrollTop=e.scrollTop},this.getChunks=function(){var b=new l;return b.before=a.fixEolChars(e.text.substring(0,e.start)),b.startTag="",b.selection=a.fixEolChars(e.text.substring(e.start,e.end)),b.endTag="",b.after=a.fixEolChars(e.text.substring(e.end)),b.scrollTop=e.scrollTop,b},this.setChunks=function(a){a.before=a.before+a.startTag,a.after=a.endTag+a.after,this.start=a.before.length,this.end=a.before.length+a.selection.length,this.text=a.before+a.selection+a.after,this.scrollTop=a.scrollTop},this.init()}function p(c,e,f){var i,j,k,l=3e3,m="delayed",n=function(b,c){a.addEvent(b,"input",c),b.onpaste=c,b.ondrop=c,a.addEvent(b,"keypress",c),a.addEvent(b,"keydown",c)},o=function(){var a=0;return window.innerHeight?a=window.pageYOffset:d.documentElement&&d.documentElement.scrollTop?a=d.documentElement.scrollTop:d.body&&(a=d.body.scrollTop),a},p=function(){if(e.preview){var a=e.input.value;if(!a||a!=k){k=a;var b=(new Date).getTime();a=c.makeHtml(a);var d=(new Date).getTime();j=d-b,y(a)}}},q=function(){if(i&&(clearTimeout(i),i=void 0),"manual"!==m){var a=0;"delayed"===m&&(a=j),a>l&&(a=l),i=setTimeout(p,a)}},r=function(a){return a.scrollHeight<=a.clientHeight?1:a.scrollTop/(a.scrollHeight-a.clientHeight)},s=function(){e.preview&&(e.preview.scrollTop=(e.preview.scrollHeight-e.preview.clientHeight)*r(e.preview))};this.refresh=function(a){a?(k="",p()):q()},this.processingTime=function(){return j};var w,t=!0,u=function(a){var b=e.preview,c=b.parentNode,d=b.nextSibling;c.removeChild(b),b.innerHTML=a,d?c.insertBefore(b,d):c.appendChild(b)},v=function(a){e.preview.innerHTML=a},x=function(a){if(w)return w(a);try{v(a),w=v}catch(b){w=u,w(a)}},y=function(a){var c=b.getTop(e.input)-o();if(e.preview&&(x(a),f()),s(),t)return void(t=!1);var d=b.getTop(e.input)-o();h.isIE?setTimeout(function(){window.scrollBy(0,d-c)},0):window.scrollBy(0,d-c)},z=function(){n(e.input,q),p(),e.preview&&(e.preview.scrollTop=0)};z()}function q(b,c,e,g,i,j,k){function p(a){if(l.focus(),a.textOp){e&&e.setCommandMode();var b=new o(c);if(!b)return;var d=b.getChunks(),f=function(){l.focus(),d&&b.setChunks(d),b.restore(),g.refresh()},h=a.textOp(d,f);h||f()}a.execute&&a.execute(e)}function q(a,b){var e="0px",f="-20px",g="-40px",i=a.getElementsByTagName("span")[0];b?(i.style.backgroundPosition=a.XShift+" "+e,a.onmouseover=function(){i.style.backgroundPosition=this.XShift+" "+g},a.onmouseout=function(){i.style.backgroundPosition=this.XShift+" "+e},h.isIE&&(a.onmousedown=function(){d.activeElement&&d.activeElement!==c.input||(c.ieCachedRange=document.selection.createRange(),c.ieCachedScrollTop=c.input.scrollTop)}),a.isHelp||(a.onclick=function(){return this.onmouseout&&this.onmouseout(),p(this),!1})):(i.style.backgroundPosition=a.XShift+" "+f,a.onmouseover=a.onmouseout=a.onclick=function(){})}function r(a){return"string"==typeof a&&(a=i[a]),function(){a.apply(i,arguments)}}function s(){var a=c.buttonBar,h=document.createElement("ul");h.id="wmd-button-row"+b,h.className="wmd-button-row",h=a.appendChild(h);var i=0,l=function(a,c,d,e){var f=document.createElement("li");f.className="wmd-button",f.style.left=i+"px",i+=25;var g=document.createElement("span");return f.id=a+b,f.appendChild(g),f.title=c,f.XShift=d,e&&(f.textOp=e),q(f,!0),h.appendChild(f),f},n=function(a){var c=document.createElement("li");c.className="wmd-spacer wmd-spacer"+a,c.id="wmd-spacer"+a+b,h.appendChild(c),i+=25};m.bold=l("wmd-bold-button",k("bold"),"0px",r("doBold")),m.italic=l("wmd-italic-button",k("italic"),"-20px",r("doItalic")),n(1),m.link=l("wmd-link-button",k("link"),"-40px",r(function(a,b){return this.doLinkOrImage(a,b,!1)})),m.quote=l("wmd-quote-button",k("quote"),"-60px",r("doBlockquote")),m.code=l("wmd-code-button",k("code"),"-80px",r("doCode")),m.image=l("wmd-image-button",k("image"),"-100px",r(function(a,b){return this.doLinkOrImage(a,b,!0)})),n(2),m.olist=l("wmd-olist-button",k("olist"),"-120px",r(function(a,b){this.doList(a,b,!0)})),m.ulist=l("wmd-ulist-button",k("ulist"),"-140px",r(function(a,b){this.doList(a,b,!1)})),m.heading=l("wmd-heading-button",k("heading"),"-160px",r("doHeading")),m.hr=l("wmd-hr-button",k("hr"),"-180px",r("doHorizontalRule")),n(3),m.undo=l("wmd-undo-button",k("undo"),"-200px",null),m.undo.execute=function(a){a&&a.undo()};var o=k(/win/.test(f.platform.toLowerCase())?"redo":"redomac");if(m.redo=l("wmd-redo-button",o,"-220px",null),m.redo.execute=function(a){a&&a.redo()},j){var p=document.createElement("li"),s=document.createElement("span");p.appendChild(s),p.className="wmd-button wmd-help-button",p.id="wmd-help-button"+b,p.XShift="-240px",p.isHelp=!0,p.style.right="0px",p.title=k("help"),p.onclick=j.handler,q(p,!0),h.appendChild(p),m.help=p}t()}function t(){e&&(q(m.undo,e.canUndo()),q(m.redo,e.canRedo()))}var l=c.input,m={};s();var n="keydown";h.isOpera&&(n="keypress"),a.addEvent(l,n,function(a){if((a.ctrlKey||a.metaKey)&&!a.altKey&&!a.shiftKey){var b=a.charCode||a.keyCode,c=String.fromCharCode(b).toLowerCase();switch(c){case"b":p(m.bold);break;case"i":p(m.italic);break;case"l":p(m.link);break;case"q":p(m.quote);break;case"k":p(m.code);break;case"g":p(m.image);break;case"o":p(m.olist);break;case"u":p(m.ulist);break;case"h":p(m.heading);break;case"r":p(m.hr);break;case"y":p(m.redo);break;case"z":p(a.shiftKey?m.redo:m.undo);break;default:return}a.preventDefault&&a.preventDefault(),window.event&&(window.event.returnValue=!1)}}),a.addEvent(l,"keyup",function(a){if(a.shiftKey&&!a.ctrlKey&&!a.metaKey){var b=a.charCode||a.keyCode;if(13===b){var c={};c.textOp=r("doAutoindent"),p(c)}}}),h.isIE&&a.addEvent(l,"keydown",function(a){var b=a.keyCode;if(27===b)return!1}),this.setUndoRedoButtonStates=t}function r(a,b,c){this.hooks=a,this.getString=b,this.converter=c}function t(a){return a.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(a,b,c){var d=!1;return b=b.replace(/%(?:[\da-fA-F]{2})|\?|\+|[^\w\d-.\/[\]]/g,function(a){if(3===a.length&&"%"==a.charAt(0))return a.toUpperCase();switch(a){case"?":return d=!0,"?";case"+":if(d)return"%20"}return encodeURI(a)}),c&&(c=c.trim?c.trim():c.replace(/^\s*/,"").replace(/\s*$/,""),c=c.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),c?b+' "'+c+'"':b})}var a={},b={},c={},d=window.document,e=window.RegExp,f=window.navigator,g={lineLength:72},h={isIE:/msie/.test(f.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(f.userAgent.toLowerCase())||/msie 5/.test(f.userAgent.toLowerCase()),isOpera:/opera/.test(f.userAgent.toLowerCase())},i={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"},j="http://",k="http://";Markdown.Editor=function(a,b,c){c=c||{},"function"==typeof c.handler&&(c={helpButton:c}),c.strings=c.strings||{},c.helpButton&&(c.strings.help=c.strings.help||c.helpButton.title);var e=function(a){return c.strings[a]||i[a]};b=b||"";var f=this.hooks=new Markdown.HookCollection;f.addNoop("onPreviewRefresh"),f.addNoop("postBlockquoteCreation"),f.addFalse("insertImageDialog"),this.getConverter=function(){return a};var h,g=this;this.run=function(){if(!h){h=new m(b);var k,l,i=new r(f,e,a),j=new p(a,h,function(){f.onPreviewRefresh()});/\?noundo/.test(d.location.href)||(k=new n(function(){j.refresh(),l&&l.setUndoRedoButtonStates()},h),this.textOperation=function(a){k.setCommandMode(),a(),g.refreshPreview()}),l=new q(b,h,k,j,i,c.helpButton,e),l.setUndoRedoButtonStates();var o=g.refreshPreview=function(){j.refresh(!0)};o()}}},l.prototype.findTags=function(b,c){var e,d=this;b&&(e=a.extendRegExp(b,"","$"),this.before=this.before.replace(e,function(a){return d.startTag=d.startTag+a,""}),e=a.extendRegExp(b,"^",""),this.selection=this.selection.replace(e,function(a){return d.startTag=d.startTag+a,""})),c&&(e=a.extendRegExp(c,"","$"),this.selection=this.selection.replace(e,function(a){return d.endTag=a+d.endTag,""}),e=a.extendRegExp(c,"^",""),this.after=this.after.replace(e,function(a){return d.endTag=a+d.endTag,""}))},l.prototype.trimWhitespace=function(a){var b,c,d=this;a?b=c="":(b=function(a){return d.before+=a,""},c=function(a){return d.after=a+d.after,""}),this.selection=this.selection.replace(/^(\s*)/,b).replace(/(\s*)$/,c)},l.prototype.skipLines=function(a,b,c){void 0===a&&(a=1),void 0===b&&(b=1),a++,b++;var d,f;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+e.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+e.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+e.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+e.$1,this.before){for(d=f="";a--;)d+="\\n?",f+="\n";c&&(d="\\n*"),this.before=this.before.replace(new e(d+"$",""),f)}if(this.after){for(d=f="";b--;)d+="\\n?",f+="\n";c&&(d="\\n*"),this.after=this.after.replace(new e(d,""),f)}},a.isVisible=function(a){return window.getComputedStyle?"none"!==window.getComputedStyle(a,null).getPropertyValue("display"):a.currentStyle?"none"!==a.currentStyle.display:void 0},a.addEvent=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},a.removeEvent=function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},a.fixEolChars=function(a){return a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n")},a.extendRegExp=function(a,b,c){null!==b&&void 0!==b||(b=""),null!==c&&void 0!==c||(c="");var f,d=a.toString();return d=d.replace(/\/([gim]*)$/,function(a,b){return f=b,""}),d=d.replace(/(^\/|\/$)/g,""),d=b+d+c,new e(d,f)},b.getTop=function(a,b){var c=a.offsetTop;if(!b)for(;a=a.offsetParent;)c+=a.offsetTop;return c},b.getHeight=function(a){return a.offsetHeight||a.scrollHeight},b.getWidth=function(a){return a.offsetWidth||a.scrollWidth},b.getPageSize=function(){var a,b,c,e;self.innerHeight&&self.scrollMaxY?(a=d.body.scrollWidth,b=self.innerHeight+self.scrollMaxY):d.body.scrollHeight>d.body.offsetHeight?(a=d.body.scrollWidth,b=d.body.scrollHeight):(a=d.body.offsetWidth,b=d.body.offsetHeight),self.innerHeight?(c=self.innerWidth,e=self.innerHeight):d.documentElement&&d.documentElement.clientHeight?(c=d.documentElement.clientWidth,e=d.documentElement.clientHeight):d.body&&(c=d.body.clientWidth,e=d.body.clientHeight);var f=Math.max(a,c),g=Math.max(b,e);return[f,g,c,e]},c.createBackground=function(){var a=d.createElement("div"),c=a.style;a.className="wmd-prompt-background",c.position="absolute",c.top="0",c.zIndex="1000",h.isIE?c.filter="alpha(opacity=50)":c.opacity="0.5";var e=b.getPageSize();return c.height=e[1]+"px",h.isIE?(c.left=d.documentElement.scrollLeft,c.width=d.documentElement.clientWidth):(c.left="0",c.width="100%"),d.body.appendChild(a),a},c.prompt=function(c,e,f){var g,i;void 0===e&&(e="");var j=function(a){var b=a.charCode||a.keyCode;if(27===b)return a.stopPropagation&&a.stopPropagation(),k(!0),!1},k=function(b){a.removeEvent(d.body,"keyup",j);var c=i.value;return b?c=null:(c=c.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(c)||(c="http://"+c)),g.parentNode.removeChild(g),f(c),!1},l=function(){g=d.createElement("div"),g.className="wmd-prompt-dialog",g.style.padding="10px;",g.style.position="fixed",g.style.width="400px",g.style.zIndex="1001";var f=d.createElement("div");f.innerHTML=c,f.style.padding="5px",g.appendChild(f);var l=d.createElement("form"),m=l.style;l.onsubmit=function(){return k(!1)},m.padding="0",m.margin="0",m.cssFloat="left",m.width="100%",m.textAlign="center",m.position="relative",g.appendChild(l),i=d.createElement("input"),i.type="text",i.value=e,m=i.style,m.display="block",m.width="80%",m.marginLeft=m.marginRight="auto",l.appendChild(i);var n=d.createElement("input");n.type="button",n.onclick=function(){return k(!1)},n.value="OK",m=n.style,m.margin="10px",m.display="inline",m.width="7em";var o=d.createElement("input");o.type="button",o.onclick=function(){return k(!0)},o.value="Cancel",m=o.style,m.margin="10px",m.display="inline",m.width="7em",l.appendChild(n),l.appendChild(o),a.addEvent(d.body,"keyup",j),g.style.top="50%",g.style.left="50%",g.style.display="block",h.isIE_5or6&&(g.style.position="absolute",g.style.top=d.documentElement.scrollTop+200+"px",g.style.left="50%"),d.body.appendChild(g),g.style.marginTop=-(b.getHeight(g)/2)+"px",g.style.marginLeft=-(b.getWidth(g)/2)+"px"};setTimeout(function(){l();var a=e.length;if(void 0!==i.selectionStart)i.selectionStart=0,i.selectionEnd=a;else if(i.createTextRange){var b=i.createTextRange();b.collapse(!1),b.moveStart("character",-a),b.moveEnd("character",a),b.select()}i.focus()},0)};var s=r.prototype;s.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",s.unwrap=function(a){var b=new e("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");a.selection=a.selection.replace(b,"$1 $2")},s.wrap=function(a,b){this.unwrap(a);var c=new e("(.{1,"+b+"})( +|$\\n?)","gm"),d=this;a.selection=a.selection.replace(c,function(a,b){return new e("^"+d.prefixes,"").test(a)?a:b+"\n"}),a.selection=a.selection.replace(/\s+$/,"")},s.doBold=function(a,b){return this.doBorI(a,b,2,this.getString("boldexample"))},s.doItalic=function(a,b){return this.doBorI(a,b,1,this.getString("italicexample"))},s.doBorI=function(a,b,c,d){a.trimWhitespace(),a.selection=a.selection.replace(/\n{2,}/g,"\n");var f=/(\**$)/.exec(a.before)[0],g=/(^\**)/.exec(a.after)[0],h=Math.min(f.length,g.length);if(h>=c&&(2!=h||1!=c))a.before=a.before.replace(e("[*]{"+c+"}$",""),""),a.after=a.after.replace(e("^[*]{"+c+"}",""),"");else if(!a.selection&&g){a.after=a.after.replace(/^([*_]*)/,""),a.before=a.before.replace(/(\s?)$/,"");var i=e.$1;a.before=a.before+g+i}else{a.selection||g||(a.selection=d);var j=c<=1?"*":"**";a.before=a.before+j,a.after=j+a.after}},s.stripLinkDefs=function(a,b){return a=a.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(a,c,d,e,f){return b[c]=a.replace(/\s*$/,""),e?(b[c]=a.replace(/["(](.+?)[")]$/,""),e+f):""})},s.addLinkDef=function(a,b){var c=0,d={};a.before=this.stripLinkDefs(a.before,d),a.selection=this.stripLinkDefs(a.selection,d),a.after=this.stripLinkDefs(a.after,d);for(var e="",f=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,g=a.before+a.selection+a.after,h=this.converter.makeHtml(g),i="http://this-is-a-real-link.biz/";h.indexOf(i)!=-1;)i+="nicetry/";var j="\n\n",k=0,l=g.replace(f,function a(b,c,d,e,g,h,l){k+=l,j+=" ["+k+"]: "+i+k+"/unicorn\n",k+=c.length,d=d.replace(f,a),k-=c.length;var m=c+d+e+k+h;return k-=l,m});h=this.converter.makeHtml(l+j);var m=function(a){return h.indexOf(i+a+"/unicorn")!==-1},n=function(a){c++,a=a.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+c+"]:"),e+="\n"+a},o=function(a,b,e,g,h,i,j){return m(k+j)?(k+=j+b.length,e=e.replace(f,o),k-=j+b.length,d[h]?(n(d[h]),b+e+g+c+i):a):a},p=a.before.length;a.before=a.before.replace(f,o),k+=p,p=a.selection.length,b?n(b):a.selection=a.selection.replace(f,o),k+=p;var q=c;return a.after=a.after.replace(f,o),a.after&&(a.after=a.after.replace(/\n*$/,"")),a.after||(a.selection=a.selection.replace(/\n*$/,"")),a.after+="\n\n"+e,q},s.doLinkOrImage=function(a,b,d){a.trimWhitespace(),a.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var e;if(!(a.endTag.length>1&&a.startTag.length>0)){if(a.selection=a.startTag+a.selection+a.endTag,a.startTag=a.endTag="",/\n\n/.test(a.selection))return void this.addLinkDef(a,null);var f=this,g=function(c){if(e.parentNode.removeChild(e),null!==c){a.selection=(" "+a.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var g=" [999]: "+t(c),h=f.addLinkDef(a,g);a.startTag=d?"![":"[",a.endTag="]["+h+"]",a.selection||(d?a.selection=f.getString("imagedescription"):a.selection=f.getString("linkdescription"))}b()};return e=c.createBackground(),d?this.hooks.insertImageDialog(g)||c.prompt(this.getString("imagedialog"),j,g):c.prompt(this.getString("linkdialog"),k,g),!0}a.startTag=a.startTag.replace(/!?\[/,""),a.endTag="",this.addLinkDef(a,null)},s.doAutoindent=function(a,b){var c=this,d=!1;a.before=a.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),a.before=a.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),a.before=a.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),a.selection||/^[ \t]*(?:\n|$)/.test(a.after)||(a.after=a.after.replace(/^[^\n]*/,function(b){return a.selection=b,""}),d=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(a.before)&&c.doList&&c.doList(a),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(a.before)&&c.doBlockquote&&c.doBlockquote(a),/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&c.doCode&&c.doCode(a),d&&(a.after=a.selection+a.after,a.selection="")},s.doBlockquote=function(a,b){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(b,c,d,e){return a.before+=c,a.after=e+a.after,d}),a.before=a.before.replace(/(>[ \t]*)$/,function(b,c){return a.selection=c+a.selection,""}),a.selection=a.selection.replace(/^(\s|>)+$/,""),a.selection=a.selection||this.getString("quoteexample");var e,c="",d="";if(a.before){for(var f=a.before.replace(/\n$/,"").split("\n"),h=!1,i=0;i<f.length;i++){var j=!1;e=f[i],h=h&&e.length>0,/^>/.test(e)?(j=!0,!h&&e.length>1&&(h=!0)):j=!!/^[ \t]*$/.test(e)||h,j?c+=e+"\n":(d+=c+e,c="\n")}/(^|\n)>/.test(c)||(d+=c,c="")}a.startTag=c,a.before=d,a.after&&(a.after=a.after.replace(/^\n?/,"\n")),a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(b){return a.endTag=b,""});var k=function(b){var c=b?"> ":"";a.startTag&&(a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"})),a.endTag&&(a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"}))};/^(?![ ]{0,3}>)/m.test(a.selection)?(this.wrap(a,g.lineLength-2),a.selection=a.selection.replace(/^/gm,"> "),k(!0),a.skipLines()):(a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(a),k(!1),!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag&&(a.startTag=a.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag&&(a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n"))),a.selection=this.hooks.postBlockquoteCreation(a.selection),/\n/.test(a.selection)||(a.selection=a.selection.replace(/^(> *)/,function(b,c){return a.startTag+=c,""}))},s.doCode=function(a,b){var c=/\S[ ]*$/.test(a.before),d=/^[ ]*\S/.test(a.after);if(!d&&!c||/\n/.test(a.selection)){a.before=a.before.replace(/[ ]{4}$/,function(b){return a.selection=b+a.selection,""});var e=1,f=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(a.before)&&(e=0),/^\n(\t|[ ]{4,})/.test(a.after)&&(f=0),a.skipLines(e,f),a.selection?/^[ ]{0,3}\S/m.test(a.selection)?/\n/.test(a.selection)?a.selection=a.selection.replace(/^/gm,"    "):a.before+="    ":a.selection=a.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(a.startTag="    ",a.selection=this.getString("codeexample"))}else a.trimWhitespace(),a.findTags(/`/,/`/),a.startTag||a.endTag?a.endTag&&!a.startTag?(a.before+=a.endTag,a.endTag=""):a.startTag=a.endTag="":(a.startTag=a.endTag="`",a.selection||(a.selection=this.getString("codeexample")))},s.doList=function(a,b,c){var d=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,f=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,h="-",i=1,j=function(){var a;return c?(a=" "+i+". ",i++):a=" "+h+" ",a},k=function(a){return void 0===c&&(c=/^\s*\d/.test(a)),a=a.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(a){return j()})};if(a.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!a.before||/\n$/.test(a.before)||/^\n/.test(a.startTag)||(a.before+=a.startTag,a.startTag=""),a.startTag){var l=/\d+[.]/.test(a.startTag);if(a.startTag="",a.selection=a.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(a),a.skipLines(),l&&(a.after=a.after.replace(f,k)),c==l)return}var m=1;a.before=a.before.replace(d,function(a){return/^\s*([*+-])/.test(a)&&(h=e.$1),m=/[^\n]\n\n[^\n]/.test(a)?1:0,k(a)}),a.selection||(a.selection=this.getString("litem"));var n=j(),o=1;a.after=a.after.replace(f,function(a){return o=/[^\n]\n\n[^\n]/.test(a)?1:0,k(a)}),a.trimWhitespace(!0),a.skipLines(m,o,!0),a.startTag=n;var p=n.replace(/./g," ");this.wrap(a,g.lineLength-p.length),a.selection=a.selection.replace(/\n/g,"\n"+p)},s.doHeading=function(a,b){if(a.selection=a.selection.replace(/\s+/g," "),a.selection=a.selection.replace(/(^\s+|\s+$)/g,""),!a.selection)return a.startTag="## ",a.selection=this.getString("headingexample"),void(a.endTag=" ##");var c=0;a.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(a.startTag)&&(c=e.lastMatch.length),a.startTag=a.endTag="",a.findTags(null,/\s?(-+|=+)/),/=+/.test(a.endTag)&&(c=1),/-+/.test(a.endTag)&&(c=2),a.startTag=a.endTag="",a.skipLines(1,1);var d=0==c?2:c-1;if(d>0){var f=d>=2?"-":"=",h=a.selection.length;for(h>g.lineLength&&(h=g.lineLength),a.endTag="\n";h--;)a.endTag+=f}},s.doHorizontalRule=function(a,b){a.startTag="----------\n",a.selection="",a.skipLines(2,1,!0)}}();